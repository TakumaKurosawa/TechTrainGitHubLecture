# Pull Request の運用ルール

## 背景

現在すべてのオペレーションが Pull Request (PR) 経由でやることになっています。

例えば、以下のことをやりたかったら、提案したい変更点を含む PR を出して、他のメンバーからレビューしてもらった後に、マージして反映させます。

- 新機能追加
- バグ対応のパッチ
- CI ワークフロー更新
- ドキュメンテーション修正
- Dev, Stg, Prod の環境へのリリース

本資料には PR の出し方やレビューのルール・プラクティスについてまとめています。

## PR を出す時のガイド

### 1. PR は小さなサイズが Better

- 機能ごとの PR ではなく、適切な粒度に分割して出す
- PR レビュー負荷が減ることで、フィードバックループが短くなるため
- PR を出してから少なくとも、 1〜2 日くらいでマージできると良い

### 2. PR がデプロイできる状態を保持

- マージの直後に Dev へ自動的にデプロイしているので、PR を小さく分けても動くことを保証しておくことが重要
- 実装途中でそのままでは動かない場合は、FeatureFlag でオフすることも可能

### 3. PR タイトルをわかりやすく・綺麗にする

- 分かりやすいリリースノートと git 履歴のため
- Squash merge を導入する場合は PR タイトル＝コミットメッセージになるのでより重要になる

### 4. PR の背景となる情報は Description に書く

- 何故必要・何を解決するかを書く
- タスクリンクや画像があれば貼る

### 5. 大きな機能で必要ならば、事前に RFC を書いてレビューしてもらう

- 実装前に設計レビューが必要な機能の場合は、RFC などで設計レビューをしてもらおう
- RFC の置き場は `docs/` 配下

### 6. Force push をできるかぎりしない

- 特にレビューのコメントが入った後にしない方がレビュアーがフォローしやすいように
- どうしても必要ならば、コメントでアナウンスしてからやる

## Review & Merge ルール

### レビュアーがレビュー作業を行い、GitHub コメントとしてフィードバックする

- 仕様に沿っているかどうか
- コード規約・分かりやすさ
- パフォーマンス
- などの視点をみて、優しいコメントをする

### レビューコメントへの対応

- 対応したら返事コメントを書いて
- レビュアーが対応を確認して、conversation を resolve する
  - nits がついているコメントは self resolve しても良い

### マージ可能要件

- マージの責任は PR の作者
- Auto merge 機能もあるので、使ってもいい
- Branch protection rule によって制御する
- 基本的には CI がすべてパスしている＆レビューコメントがすべて解決されている状態をミニマム要件とすることを推奨する
